# Reference
<!-- DO NOT EDIT: This document was generated by Puppet Strings -->

## Table of Contents

**Classes**

* [`mysql`](#mysql): Initializes the MySQL module.
* [`mysql::config`](#mysqlconfig): Handles the main configuration of a MySQL server.
* [`mysql::database`](#mysqldatabase): Manages MySQL databases.
* [`mysql::globals`](#mysqlglobals): Defines global variables and resources to use throughout the rest of the module.
* [`mysql::install`](#mysqlinstall): Handles the installation of a MySQL server.
* [`mysql::params`](#mysqlparams): Sets the values of parameters based on certain conditions.
* [`mysql::root_user`](#mysqlroot_user): Manages the MySQL root user.
* [`mysql::secure_install`](#mysqlsecure_install): Processes additional steps to create a more secure MySQL environment.
* [`mysql::service`](#mysqlservice): Handles the MySQL service.
* [`mysql::user`](#mysqluser): Manages MySQL users.
* [`mysql::validation`](#mysqlvalidation): Handles the validation of some parameters.

**Defined types**

* [`mysql::database::ensure`](#mysqldatabaseensure): Ensures the state of MySQL databases.
* [`mysql::user::ensure`](#mysqluserensure): Ensures the state of MySQL users.
* [`mysql::user::password`](#mysqluserpassword): Manages passwords for MySQL users.
* [`mysql::user::permissions`](#mysqluserpermissions): Manages permissions on databases for MySQL users.

**Functions**

* [`mysql::generate_query`](#mysqlgenerate_query): Creates MySQL queries for managing MySQL user permissions.
* [`mysql::get_permission_list`](#mysqlget_permission_list): Creates a permission hash for MySQL users.

## Classes

### mysql

Within this class we defined some parameters that need an integer value followed by a string value
in order to define a certain value (in example the query_cache_size parameter, which defaults to '16M'.
This has been done to prevent parameters from getting too complex, leaving the user to specify which
value they want to set.

For the same reason (preventing parameters from getting too complex) we did specify some ENUM's, but
have left more complex parameter objects to the validation class. Their format is found in the README.

A lot of the parameters have pretty standard defaults. This has been done so the module is rather easy
and standard to use out of the box, but allows people to easily override settings.

#### Parameters

The following parameters are available in the `mysql` class.

##### `root_password`

Data type: `NotUndef[String]`

Password for the root user in plain text.

##### `secure_install`

Data type: `NotUndef[Boolean]`

Whether to secure the installation or leave it as default.

Default value: `true`

##### `config_path`

Data type: `NotUndef[String]`

The path to the configuration file. Defaults to a location determined by the params class.

Default value: $mysql::params::config_path

##### `port`

Data type: `NotUndef[Integer]`

The port MySQL should listen on.

Default value: 3306

##### `bind_address`

Data type: `NotUndef[String]`

Binds MySQL to a specific IP address.

Default value: '127.0.0.1'

##### `skip_networking`

Data type: `NotUndef[Boolean]`

Whether to allow network connections or local connections only.

Default value: `false`

##### `default_storage_engine`

Data type: `NotUndef[Enum['innodb',
                  'myisam',
                  'memory',
                  'csv',
                  'archive',
                  'blackhole',
                  'ndb',
                  'merge',
                  'federated',
                  'example']]`

Sets the default storage engine the server uses.

Default value: 'innodb'

##### `max_connections`

Data type: `NotUndef[Integer]`

Sets the maximum amount of permitted connections.

Default value: 150

##### `max_connect_errors`

Data type: `NotUndef[Integer]`

Sets the amount of permitted connection errors before a host will be blocked.

Default value: 100

##### `max_allowed_packet`

Data type: `NotUndef[String]`

Sets the maximum permitted packet size of packets handled by MySQL.

Default value: '16M'

##### `thread_stack`

Data type: `NotUndef[String]`

Sets the stack size of each thread.

Default value: '256K'

##### `thread_cache_size`

Data type: `NotUndef[Integer]`

Sets the amount of (unused) threads to store in a cache.

Default value: 8

##### `table_cache`

Data type: `NotUndef[Integer]`

Sets the amount of open tables for all threads.

Default value: 64

##### `explicit_timestamp_defaults`

Data type: `NotUndef[Boolean]`

When disabled MySQL will handle default values for timestamp records in a nonstandard way.

Default value: `true`

##### `local_infile`

Data type: `NotUndef[Boolean]`

Enables the ability to load a local file into MySQL. Use with caution due to security risks.

Default value: `false`

##### `key_buffer_size`

Data type: `NotUndef[String]`

Sets the size of the buffer used for index blocks.

Default value: '16M'

##### `myisam_recover_options`

Data type: `NotUndef[Enum['off',
                  'backup',
                  'backup_all',
                  'default',
                  'force',
                  'quick']]`

Sets the MyISAM storage engine recovery mode.

Default value: 'backup'

##### `innodb_buffer_pool_size`

Data type: `NotUndef[String]`

Sets the size of the InnoDB buffer pool for caching data and indexes.

Default value: '1G'

##### `innodb_buffer_pool_instances`

Data type: `NotUndef[Integer]`

Sets the number of regions the InnoDB buffer pool is divided into.

Default value: 8

##### `innodb_log_file_size`

Data type: `NotUndef[String]`

Sets the size of InnoDB log files.

Default value: '1G'

##### `innodb_log_buffer_size`

Data type: `NotUndef[String]`

Sets the size of the InnoDB buffer, allowing transactions to run without writing to disk before the transaction is committed.

Default value: '16M'

##### `innodb_file_per_table`

Data type: `NotUndef[Boolean]`

Splits InnoDB database files per table instead of one big file.

Default value: `true`

##### `innodb_stats_on_metadata`

Data type: `NotUndef[Boolean]`

Will update InnoDB index statistics when enabled.

Default value: `false`

##### `innodb_large_prefix`

Data type: `NotUndef[Boolean]`

Allows larger prefixes for index columns.

Default value: `true`

##### `query_cache_limit`

Data type: `NotUndef[String]`

Sets the maximum limit for the size of queries to cache.

Default value: '1M'

##### `query_cache_size`

Data type: `NotUndef[String]`

When enabled will keep queries in cache. Use with caution for this option is known to cause performance issues.

Default value: '0'

##### `enable_general_log`

Data type: `NotUndef[Boolean]`

Enables general query logging.

Default value: `false`

##### `enable_error_log`

Data type: `NotUndef[Boolean]`

Enables the logging of MySQL errors.

Default value: `false`

##### `enable_slow_log`

Data type: `NotUndef[Boolean]`

Enables the logging of slow queries.

Default value: `false`

##### `long_query_time`

Data type: `NotUndef[Integer]`

Sets the amount of seconds before a query is considered slow.

Default value: 2

##### `server_type`

Data type: `NotUndef[Enum['standalone',
                  'master',
                  'slave']]`

Specifies the type of the server, necessary in a master / slave setup.

Default value: 'standalone'

##### `enable_ssl`

Data type: `NotUndef[Boolean]`

Enables encrypted / SSL connections to the MySQL server.

Default value: `false`

##### `additional_root_hosts`

Data type: `Optional[Array]`

Sets additional hosts for the root user to connect from.

Default value: `undef`

##### `server_id`

Data type: `Optional[Integer]`

Sets the (unique) server id for a master / slave setup.

Default value: `undef`

##### `log_expiration`

Data type: `Optional[Integer]`

Sets the amount of days after which binary logs should expire.

Default value: `undef`

##### `binlog_size`

Data type: `Optional[String]`

Sets the size of logfiles after which they should be rotated.

Default value: `undef`

##### `log_bin`

Data type: `Optional[String]`

Sets the path to the binary log.

Default value: `undef`

##### `replicate_db`

Data type: `Optional[Array]`

Specifies which databases should be replicated in a master / slave setup.

Default value: `undef`

##### `ssl_ca_cert`

Data type: `Optional[String]`

Specifies the location to the SSL Certificate Authority file.

Default value: `undef`

##### `ssl_cert`

Data type: `Optional[String]`

Specifies the location to the SSL Certificate file.

Default value: `undef`

##### `ssl_key`

Data type: `Optional[String]`

Specifies the location to the SSL private key file.

Default value: `undef`

##### `databases`

Data type: `Optional[Hash]`

Contains databases to manage through Puppet. See the README for a full example for this parameter.

Default value: `undef`

##### `users`

Data type: `Optional[Array]`

Contains users to manage through Puppet. See the README for a full example for this parameter.

Default value: `undef`

### mysql::config

Handles the main configuration of a MySQL server.

### mysql::database

Manages MySQL databases.

### mysql::globals

Defines global variables and resources to use throughout the rest of the module.

### mysql::install

Handles the installation of a MySQL server.

### mysql::params

Sets the values of parameters based on certain conditions.

### mysql::root_user

Because the MySQL root user is an exceptional user we do not manage this user through the
generic 'mysql::user' class alone.

The exceptions we have made for this user are found underneath:
* MySQL connection_string:
  The MySQL connection_string uses the password retrieved by facter instead of the
  password in the 'root_password' paramater. This is necessary to ensure we can
  connect with the database as root when we want to change the password through the parameter.

* Another 'reload_privileges' exec:
  When we update the root password we need to reload (flush) the privileges. Before doing this
  the old password (as retrieved by facter) as used. Therefore a new reload_privileges using
  this password is created for managing the root privileges alone.

* Required hosts:
  A set of required hosts (localhost and it's IPv4 / IPv6 addresses) are always
  ensured for this user. This allows us to always be able to connect to MySQL from localhost.

* Additional hosts:
  We can expand the hosts the root user is allowed to connect from through a parameter.

* Password type:
  To ensure that we know what password is used the password type is set to 'plain_text'.

* Hidden password file:
  To be able to retrieve the current root password we created a small custom fact in ruby,
  which reads the password from a hidden file. In this class said file is created and it content
  updated with the password.

* Permissions:
  We ensure 'full' permissions on every root user, so it will be able to manage everything through root.

* Unknown hosts:
  Hosts that are not listed in the required_hosts list and additional_hosts list are deleted.

### mysql::secure_install

This class processes some additional steps to create a more secure MySQL environment.

By default MySQL installs a 'test' database, which we will remove. Privileges assigned to this database
will also be removed. If a database with the name 'test' or privileges for this databases are created
again Puppet will delete it through this class.

Users with an empty username (anonymous users) or without a password will be removed as well, since we
decided to not allow those on our servers when 'secure_install' is set to true.

Lastly, the .mysql_history file for the root user will be pointed to /dev/null to ensure sensitive data
is not stored.

### mysql::service

Handles the MySQL service.

### mysql::user

This class manages MySQL users by retrieving their information from the user hash and
pass this information along to the corresponding user related defined types.

The global 'ensure' state of a user determines whether an user will be managed or not.
If this state is set to 'absent' the complete user and all of their settings will be
deleted, regardless what the other settings have been set to.

Upon deleting an user every permission set in the 'user' parameter for said user will
be deleted as well. Any 'unmanaged' settings, if there are any, will be skipped as Puppet
will not know about these settings.

### mysql::validation

Certain parameters depend on other parameters or will have a more complex structure, which
is not easily enforced by using enum's or the like. This class ensures the right values for
parameters, making the module a bit more user friendly.

## Defined types

### mysql::database::ensure

Ensures the state of MySQL databases.

#### Parameters

The following parameters are available in the `mysql::database::ensure` defined type.

##### `database`

Data type: `String`

The name of the database.

##### `state`

Data type: `Enum['present', 'absent']`

The state we want the database to be in.

### mysql::user::ensure

This define ensures the state of MySQL users by either creating or deleting an user if necessary.

A password can be a string containing either a plain text password or a MySQL password hash. If
the type is set on 'plain_text' MySQL will create a hash for us. If the type is set on 'hash' MySQL
expects a hashed password.

#### Parameters

The following parameters are available in the `mysql::user::ensure` defined type.

##### `user`

Data type: `NotUndef[String]`

The name of the user.

##### `host`

Data type: `NotUndef[String]`

The host the user will be able to connect from.

##### `state`

Data type: `NotUndef[Enum['present', 'absent']]`

The state we need to ensure for the user.

##### `password`

Data type: `Optional[String]`

The password to use for the user.

Default value: `undef`

##### `password_type`

Data type: `Optional[Enum['hash', 'plain_text']]`

Whether the password is a plain text string or an already hashed password.

Default value: `undef`

### mysql::user::password

This define manages passwords for MySQL users.

A password can be a string containing either a plain text password or a MySQL password hash. If
the type is set on 'plain_text' we use MySQL's PASSWORD() function to create a hash ourselves.

#### Parameters

The following parameters are available in the `mysql::user::password` defined type.

##### `user`

Data type: `NotUndef[String]`

The name of the user.

##### `host`

Data type: `NotUndef[String]`

The host the user will be able to connect from.

##### `password`

Data type: `NotUndef[String]`

The password to use for the user.

##### `password_type`

Data type: `NotUndef[Enum['plain_text', 'hash']]`

The type of the password that is used.

### mysql::user::permissions

This define manages permissions on databases for MySQL users by predefined roles.

A MySQL user has global permissions in the mysql.user table and database specific permissions
in the mysql.db table. Based on the 'database' parameter being either a database name or an
asterisk (*), the permissions for the user will be set globally or for a specific database.

By using our own Ruby functions a permission list (which is a hash) is generated, which is
used to generate the different necessary queries, like an insert query and a select query
which both will contain the right columns and values in the proper query format.

These queries will be used in the required exec's for managing the permissions.

When the state of an user is 'absent' the permissions will only be deleted when they are database
specific permissions. Global permissions are already deleted by ensuring the user to be absent.

The different roles grant predefined permissions on a user. An overview can be found in the README.md file.

#### Parameters

The following parameters are available in the `mysql::user::permissions` defined type.

##### `user`

Data type: `NotUndef[String]`

The name of the user.

##### `host`

Data type: `NotUndef[String]`

The host the user will be able to connect from.

##### `state`

Data type: `NotUndef[Enum['present', 'absent']]`

The state we want the user to be in.

##### `database`

Data type: `NotUndef[String]`

The database to give a user permissions on. Use '*' for global permissions.

##### `user_role`

Data type: `NotUndef[Enum['read_only',
                  'read_write',
                  'read_write_extended',
                  'slave',
                  'none',
                  'full']]`

The role of the user. See the notes for an overview on the available roles and their use.

## Functions

### mysql::generate_query

Type: Ruby 4.x API

Creates MySQL queries for managing MySQL user permissions.

#### `mysql::generate_query(Enum['select',
                             'insert',
                             'update'] $query_type, String $user, String $host, Hash $permission_list, Optional[Boolean] $extend_select, Optional[String] $database)`

The mysql::generate_query function.

Returns: `String` A string containing the generated query.

Raises:
* `PuppetError` When an incorrect query_type is given.
* `PuppetError` When trying to generate an INSERT query for global user permissions.

##### `query_type`

Data type: `Enum['select',
                             'insert',
                             'update']`

The type of the query to generate.

##### `user`

Data type: `String`

The name of the MySQL user to use.

##### `host`

Data type: `String`

The host the user will be able to connect from.

##### `permission_list`

Data type: `Hash`

The permission list in hash format to generate a query from.

##### `extend_select`

Data type: `Optional[Boolean]`

Whether to extend the WHERE clause of the SELECT query with the permission list values.

##### `database`

Data type: `Optional[String]`

The name of the database when setting database specific permissions.

### mysql::get_permission_list

Type: Ruby 4.x API

Creates a permission hash for MySQL users.

#### `mysql::get_permission_list(Enum['global', 'database_specific'] $permission_type, String $user_role)`

The mysql::get_permission_list function.

Returns: `Hash` Returns the permissions in a hash.

Raises:
* `PuppetError` When an incorrect value is given for the user_role parameter.
* `PuppetError` When trying to assign global permissons when permisison_type is set to 'database_specific'.

##### `permission_type`

Data type: `Enum['global', 'database_specific']`

Whether to return global or database specific permissions.

##### `user_role`

Data type: `String`

The role of the user to define which privileges they should get.

